{% extends "base.html" %}

{% block title %}Agent installer Â· PlayrServers Management{% endblock %}

{% block content %}
<section class="card">
  <h1 class="card__title">Install the hypervisor agent</h1>
  <p class="card__subtitle">Provision an Ubuntu host with the PlayrServers agent to manage QEMU virtual machines remotely.</p>
  <div class="callout">
    <code>curl -fsSL {{ request.url_for('agent_installer_script') }} | sudo bash</code>
  </div>
  <p>The installer configures QEMU, libvirt, and supporting packages before deploying the agent runtime and systemd service.</p>
  <p>{{ api_help }}</p>
  <h2>Generate an API key</h2>
  <p>Create a dedicated credential for hypervisors connecting back to this management plane.</p>
  {% if api_key_error %}
  <div class="alert alert--error">{{ api_key_error }}</div>
  {% endif %}
  {% if generated_api_key %}
  <div class="callout callout--success">
    <p><strong>Your new API key</strong></p>
    <code>{{ generated_api_key }}</code>
    <p class="text-muted">Copy this key now. It will not be shown again.</p>
  </div>
  {% endif %}
  <form method="post" action="{{ request.url_for('ui_generate_api_key') }}" class="form">
    <label class="form__label" for="api-key-name">Key name</label>
    <input class="form__input" type="text" id="api-key-name" name="name" value="{{ api_key_form_name }}" required />
    <button type="submit" class="button button--primary">Generate API key</button>
  </form>
  <h2>Non-interactive usage</h2>
  <p>Pass installer flags to customise the deployment:</p>
  <pre><code>curl -fsSL {{ request.url_for('agent_installer_script') }} | sudo bash -s -- --api-key &lt;your-api-key&gt; --agent-id {{ user.name | replace(' ', '-') | lower }}</code></pre>
</section>

<section class="card">
  <h2 class="card__title">What gets installed?</h2>
  <ul class="list">
    <li>Required QEMU/KVM and libvirt packages for Ubuntu hosts.</li>
    <li>A dedicated <code>playr-agent</code> system user and Python virtual environment.</li>
    <li>The PlayrServers agent service that maintains an encrypted tunnel to {{ request.url.hostname or 'api.playrservers.com' }}.</li>
    <li>Automatic systemd integration so the agent starts on boot and restarts after failures.</li>
  </ul>
</section>
{% endblock %}
